faxes_nm                 = NULL,
range_faxes              = c(NA, NA),
color_bg                 = "grey95",
shape_sp                 = c(pool = 3, asb1 = 21, asb2 = 21),
size_sp                  = c(pool = 0.7, asb1 = 1, asb2 = 1),
color_sp                 = c(pool = "grey50", asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
color_vert               = c(pool = "grey50", asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
fill_sp                  = c(pool = NA, asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
fill_vert                = c(pool = NA, asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
color_ch                 = c(pool = NA, asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
fill_ch                  = c(pool = "white", asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
alpha_ch                 = c(pool = 1, asb1 = 0.3, asb2 = 0.3),
shape_centroid_fdis      = c(asb1 = 22,  asb2 = 24),
shape_centroid_fdiv      = c(asb1 = 22,  asb2 = 24),
shape_centroid_fspe      = 23,
color_centroid_fspe      = "black",
size_sp_nm               = 3,
color_sp_nm              = "black",
plot_sp_nm               = NULL,
fontface_sp_nm           = "plain",
save_file                = FALSE,
check_input              = TRUE)
plots_alpha$"fric"$"patchwork"
FD_ind_values <- fd_ind_values %>%
tibble::rownames_to_column() %>%
rename(caseID = rowname)
#new df
Fdiv <- FD_ind_values%>%
distinct(caseID,sp_richn,fdis,fmpd,fnnd,feve,fric,fspe)%>%
left_join(., all.stab.auc, by = c('caseID'))
#new df
Fdiv <- FD_ind_values%>%
distinct(caseID,sp_richn,fdis,fmpd,fnnd,feve,fric,fspe)%>%
left_join(., ComStab, by = c('caseID'))
which(is.na(Fdiv$OEV))
which(is.na(Fdiv$AUC.sum.delatbm.tot))
Fdiv$organism[Fdiv$organism == 'Cladoceran'] <- 'zooplankton'
str(Fdiv)
Fdiv %>%
# select(caseID, fdis, fric, feve, sp_richn,studyID, organism, dist.cat, OEV, resp.cat,system,OrganismType) %>%
gather(c(fdis, fric, feve), key = 'Indices', value = 'IndexValue') %>%
ggplot(., aes(x = IndexValue, y = OEV))+
geom_point(size = 2, alpha = .4)+
labs(x = 'F Dispersion', y = 'AUC.sum.delatbm.tot')+
facet_grid(~Indices, scales = 'free_x') +
theme_bw()+
theme(text = element_text(size=rel(4)),
strip.text.x = element_text(size=rel(4)))
Fdiv %>%
# select(caseID, fdis, fric, feve, sp_richn,studyID, organism, dist.cat, OEV, resp.cat,system,OrganismType) %>%
gather(c(fdis, fric, feve), key = 'Indices', value = 'IndexValue') %>%
ggplot(., aes(x = IndexValue, y = AUC.sum.delatbm.tot))+
geom_point(size = 2, alpha = .4)+
labs(x = 'F Dispersion', y = 'AUC.sum.delatbm.tot')+
facet_grid(~Indices, scales = 'free_x') +
theme_bw()+
theme(text = element_text(size=rel(4)),
strip.text.x = element_text(size=rel(4)))
sp_richn<-ggplot(Fdiv, aes(x = sp_richn, y = AUC.sum.delatbm.tot))+
geom_hline(yintercept = 0)+
geom_point(size = 2, alpha = .4)+
geom_smooth(method='lm')+
labs(x = 'S Richness', y = 'AUC.sum.delatbm.tot')+
theme_bw()+
theme(legend.position = 'bottom')
sp_richn
sp_richn<-ggplot(Fdiv, aes(x = sp_richn, y = AUC.sum.delatbm.tot))+
geom_hline(yintercept = 0)+
geom_point(size = 2, alpha = .4)+
labs(x = 'S Richness', y = 'AUC.sum.delatbm.tot')+
theme_bw()+
theme(legend.position = 'bottom')
ggsave(last_plot(), file = here('~/Desktop/phD/Meta_Multistab/FDiv_LinFdivAdj.png'), width = 14, height = 10)
sp_richn<-ggplot(Fdiv, aes(x = sp_richn, y = AUC.sum.delatbm.tot))+
geom_hline(yintercept = 0)+
geom_point(size = 2, alpha = .4)+
labs(x = 'S Richness', y = 'AUC.sum.delatbm.tot')+
theme_bw()+
theme(legend.position = 'bottom')
sp_richn
ggsave(last_plot(), file = here('~/Desktop/phD/Meta_Multistab/FDiv_LinFdivAdj.png'), width = 14, height = 10)
Fdiv %>%
# select(caseID, fdis, fric, feve, sp_richn,studyID, organism, dist.cat, OEV, resp.cat,system,OrganismType) %>%
gather(c(fdis, fric, feve), key = 'Indices', value = 'IndexValue') %>%
ggplot(., aes(x = IndexValue, y = AUC.sum.delatbm.tot))+
geom_point(size = 2, alpha = .4)+
labs(x = 'F Dispersion', y = 'Community Instability')+
facet_grid(~Indices, scales = 'free_x') +
theme_bw()+
theme(text = element_text(size=rel(4)),
strip.text.x = element_text(size=rel(4)))
Fdiv %>%
# select(caseID, fdis, fric, feve, sp_richn,studyID, organism, dist.cat, OEV, resp.cat,system,OrganismType) %>%
gather(c(fdis, fric, feve), key = 'Indices', value = 'IndexValue') %>%
ggplot(., aes(x = IndexValue, y = AUC.sum.delatbm.tot))+
geom_point(size = 2, alpha = .4)+
labs(x = 'Fdiv Value', y = 'Community Instability')+
facet_grid(~Indices, scales = 'free_x') +
theme_bw()+
theme(text = element_text(size=rel(4)),
strip.text.x = element_text(size=rel(4)))
Fdiv %>%
# select(caseID, fdis, fric, feve, sp_richn,studyID, organism, dist.cat, OEV, resp.cat,system,OrganismType) %>%
gather(c(fdis, fric, feve), key = 'Indices', value = 'IndexValue') %>%
ggplot(., aes(x = IndexValue, y = AUC.sum.delatbm.tot))+
geom_point(size = 2, alpha = .6)+
labs(x = 'Fdiv Value', y = 'Community Instability')+
facet_grid(~Indices, scales = 'free_x') +
theme_bw()+
theme(text = element_text(size=rel(4)),
strip.text.x = element_text(size=rel(4)))
study <- read_excel("~/Desktop/phD/Meta_Multistab/MetaMultistab/Multistab_species_data_mfd.xlsx") %>%
select(-c(35:51)) %>%
rename(caseID = paper)
metadata_Fdiv <- left_join(Fdiv, study, by = c('caseID')) %>%
drop_na(RD.metric) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, RD.metric, RD.value) %>%
# filter(!str_detect(RD.metric, 'abs'))%>%
spread(key = RD.metric, value = RD.value)
metadata_Fdiv <- left_join(Fdiv, study, by = c('caseID')) %>%
drop_na(RD.metric) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, fdis, fric, feve)
metadata_Fdiv <- left_join(Fdiv, study, by = c('caseID')) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, fdis, fric, feve)
metadata_Fdiv <- left_join(Fdiv, study, by = c('caseID')) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,OEV,AUC.sum.delatbm.tot, fdis, fric, feve)
hist(metadata_Fdiv$OEV)
unique(metadata_Fdiv$caseID)
metadata_Fdiv <- filter(metadata_Fdiv, resp.cat !=  "contribution to production")
# unweighted MA requires column 1
metadata_Fdiv$unweighted<-1
names(metadata_Fdiv)
Fdiv.m<-rma.mv(OEV,unweighted,
mods = ~fdis+fric+feve+dist.cat+system+open+organism+duration,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(test.complete) #188.0872
summary(Fdiv.m) #188.0872
Fdiv.m<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~fdis+fric+feve+dist.cat+system+open+organism+duration,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(Fdiv.m) #188.0872
#2
Fdiv.m<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~fdis+fric+feve+dist.cat+system,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(Fdiv.m) #188.0872
#2
Fdiv.m<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~fdis+fric+feve+system,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(Fdiv.m) #174.3956
#2
Fdiv.m<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~fdis+fric+feve+system,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(Fdiv.m) #174.2335
##m3
delt.complete<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+open+organism,dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
##m3
delt.complete<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+open+organism+dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(delt.complete)
organism
organism
##m3
delt.complete<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+organism+dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(delt.complete)
##m3
delt.complete<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(delt.complete)
#2
Fdiv.m<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~fdis+fric+feve+system,
random = ~ 1 | caseID,
method="REML",data=metadata_Fdiv)
summary(Fdiv.m) #174.2335
### forest ###
forest_plot <- forest(delt.complete$b, # This is our vector of two effect sizes for our 2 sub-categories
ci.lb = delt.complete$ci.lb, # Confidence interval lower bounds
ci.ub = delt.complete$ci.ub, # Confidence interval upper bounds
annotate = TRUE, # This tells function to list effect size and CIs for each group on our graph
xlab = "ln(Response Ratio)", # label for x-axis
# slab = c('intrcpt','mean_spp_deltabm','systemmarine','systemterrestrial'), #label for y-axis
cex = 1, # Font size for entire graph (excluding headers)
digits = 2 # Round effect size and CI to 2 digits
)
op <- par(cex=1, font=2) # Set up font for rest of graph (just the headers of the graph remain), to make bold headings, set font=2
text(2.7, 3.5, "ln(Response Ratio) [95% CI]")
text(-2.1,3.5, "Mods")
#remove all
delt.complete<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(delt.complete)
complete.mod<-tidy(summary(delt.complete))
complete.mod$k<-delt.complete$k
complete.mod$AIC<-delt.complete$fit.stats$REML[3] #185.7469
### forest ###
forest_plot <- forest(delt.complete$b, # This is our vector of two effect sizes for our 2 sub-categories
ci.lb = delt.complete$ci.lb, # Confidence interval lower bounds
ci.ub = delt.complete$ci.ub, # Confidence interval upper bounds
annotate = TRUE, # This tells function to list effect size and CIs for each group on our graph
xlab = "ln(Response Ratio)", # label for x-axis
# slab = c('intrcpt','mean_spp_deltabm','systemmarine','systemterrestrial'), #label for y-axis
cex = 1, # Font size for entire graph (excluding headers)
digits = 2 # Round effect size and CI to 2 digits
)
op <- par(cex=1, font=2) # Set up font for rest of graph (just the headers of the graph remain), to make bold headings, set font=2
text(2.7, 3.5, "ln(Response Ratio) [95% CI]")
text(-2.1,3.5, "Mods")
### forest ###
forest_plot <- forest(delt.complete$b, # This is our vector of two effect sizes for our 2 sub-categories
ci.lb = delt.complete$ci.lb, # Confidence interval lower bounds
ci.ub = delt.complete$ci.ub, # Confidence interval upper bounds
annotate = TRUE, # This tells function to list effect size and CIs for each group on our graph
xlab = "ln(Response Ratio)", # label for x-axis
slab = c('intrcpt','mean_spp_deltabm'), #label for y-axis
cex = 1, # Font size for entire graph (excluding headers)
digits = 2 # Round effect size and CI to 2 digits
)
op <- par(cex=1, font=2) # Set up font for rest of graph (just the headers of the graph remain), to make bold headings, set font=2
text(2.7, 3.5, "ln(Response Ratio) [95% CI]")
text(-2.1,3.5, "Mods")
summary(delt.complete)
### relative contributions ###
RelMetadata <- left_join(AllStabrel, study, by = c('caseID', 'resp.cat')) %>%
drop_na(RD.metric) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, RD.metric, RD.value) %>%
# filter(!str_detect(RD.metric, 'abs'))%>%
spread(key = RD.metric, value = RD.value)
hist(RelMetadata$OEV)
unique(RelMetadata$caseID)
metadata <- filter(RelMetadata, resp.cat !=  "contribution to production")
# unweighted MA requires column 1
RelMetadata$unweighted<-1
names(RelMetadata)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_pi,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(delt.complete)
summary(m1)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+resp.cat+dist.cat+system+open+duration+organism,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m1)
summary(m1) #190.6149
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+resp.cat+dist.cat+system+open,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+resp.cat+dist.cat+system+open,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+dist.cat+system+open,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+resp.cat+dist.cat+system+open+duration+organism,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m1) #190.6149
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #190.6149
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+system ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #189.0552
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #189.0552
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+mean_spp_pi+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #189.0552
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_div+mean_spp_pi+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #189.0552
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #189.0552
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #188.9044
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_pi+system+open+dist.cat ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #188.9044
m2<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_pi+system+open ,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m2) #188.9044
### forest ###
forest_plot <- forest(m2$b, # This is our vector of two effect sizes for our 2 sub-categories
ci.lb = m2$ci.lb, # Confidence interval lower bounds
ci.ub = m2$ci.ub, # Confidence interval upper bounds
annotate = TRUE, # This tells function to list effect size and CIs for each group on our graph
xlab = "ln(Response Ratio)", # label for x-axis
# slab = c('intrcpt','mean_spp_deltabm'), #label for y-axis
cex = 1, # Font size for entire graph (excluding headers)
digits = 2 # Round effect size and CI to 2 digits
)
##m3
m03<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m03)
# unweighted MA requires column 1
metadata$unweighted<-1
### delatbm.tot ###
#m0
m0<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_deltabm+mean_spp_deltabm+resp.cat+dist.cat+system+open+duration+organism,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(AllStab)
names(AllStab)
study <- read_excel("~/Desktop/phD/Meta_Multistab/MetaMultistab/Multistab_species_data_mfd.xlsx") %>%
select(-c(35:51)) %>%
rename(caseID = paper)
metadata <- left_join(AllStab, study, by = c('caseID', 'resp.cat')) %>%
drop_na(RD.metric) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, RD.metric, RD.value) %>%
# filter(!str_detect(RD.metric, 'abs'))%>%
spread(key = RD.metric, value = RD.value)
setdiff(AllStab$caseID,metadata$caseID)
hist(metadata$OEV)
unique(metadata$caseID)
metadata <- filter(metadata, resp.cat !=  "contribution to production")
# unweighted MA requires column 1
metadata$unweighted<-1
names(metadata)
### delatbm.tot ###
#m0
m0<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_deltabm+mean_spp_deltabm+resp.cat+dist.cat+system+open+duration+organism,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m0)
## m1
m01<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+var_spp_deltabm+mean_spp_deltabm+resp.cat+system+organism,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m01)
##m2
#remove organism, duration, resp.cat, dist.cat,open,system
m02<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+var_spp_deltabm+mean_spp_deltabm,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m02)
##m3
m03<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm+resp.cat+system+dist.cat,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m03)
#remove all
m04<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m04)
anova(m0,m01,m02,m03,m04)
anova(m02,m03,m04)
summary(m04)
summary(m03)
summary(m02)
summary(m01)
AllStabrel %>%
filter(str_detect(RD.metric,'abs' ))%>%
ggplot(., aes ( x = RD.value, y = OEV))+
geom_point(color = 'darkgreen')+
# geom_smooth(method = lm, se = F, alpha = 0.6)+
facet_wrap(~RD.metric, scales = 'free_x')+
theme_bw()+
labs(x = '')
AllStab %>%
filter(str_detect(RD.metric,'abs' ))%>%
ggplot(., aes ( x = RD.value, y = OEV))+
geom_point()+
labs(x = '')+
facet_wrap(~RD.metric, scales = 'free_x')+
theme_bw()
#libraries we need
library(metafor)
library(broom)
summary(AllStab)
summary(AllStab)
names(AllStab)
study <- read_excel("~/Desktop/phD/Meta_Multistab/MetaMultistab/Multistab_species_data_mfd.xlsx") %>%
select(-c(35:51)) %>%
rename(caseID = paper)
rm(list=ls())
graphics.off()
library(tidyverse)
library(readxl)
library(here)
library(cowplot)
library(GGally)
library(ggpubr)
# species stability
SpeciesStab <- read_csv('~/Desktop/phD/Meta_Multistab/MetaMultistab/output/SpeciesStabilities.csv')%>%  select(-'...1')
# community stability
ComStab <- read_csv('~/Desktop/phD/Meta_Multistab/MetaMultistab/output/CommunityStabilities.csv')%>%  select(-'...1')
# Merged Stability
MergedComStab<- read_csv('~/Desktop/phD/Meta_Multistab/MetaMultistab/output/MergedCommunityStability.csv') %>%  select(-'...1')
source(here("~/Desktop/phD/Meta_Multistab/response-diversity-pulse-pert/R/Ross_et_al_functions.R"))
names(SpeciesStab)
igr.pert <- SpeciesStab %>%
group_by(caseID, resp.cat) %>%
reframe(mean_spp_deltabm = mean(AUC.RR),
var_spp_deltabm = var(AUC.RR),
RD_diss = resp_div(AUC.RR, sign_sens = FALSE),
RD_div = resp_div(AUC.RR, sign_sens = TRUE),
mean_abs_spp_deltabm = mean(abs(AUC.RR)),
var_abs_spp_deltabm = var(abs(AUC.RR)),
RD_abs_diss = resp_div(abs(AUC.RR), sign_sens = FALSE),
RD_abs_div = resp_div(abs(AUC.RR), sign_sens = TRUE)) %>%
ungroup()%>%
gather(mean_spp_deltabm,var_spp_deltabm,RD_diss,RD_div, mean_abs_spp_deltabm,var_abs_spp_deltabm,RD_abs_div,RD_abs_diss,key = 'RD.metric', value = 'RD.value')
#### Merge community stability and RD ####
AllStab <- merge(igr.pert,ComStab, by = c('caseID', 'resp.cat'))
AllStab %>%
filter(str_detect(RD.metric,'abs' ))%>%
ggplot(., aes ( x = RD.value, y = OEV))+
geom_point()+
labs(x = '')+
facet_wrap(~RD.metric, scales = 'free_x')+
theme_bw()
#libraries we need
library(metafor)
library(broom)
summary(AllStab)
names(AllStab)
study <- read_excel("~/Desktop/phD/Meta_Multistab/MetaMultistab/Multistab_species_data_mfd.xlsx") %>%
select(-c(35:51)) %>%
rename(caseID = paper)
metadata <- left_join(AllStab, study, by = c('caseID', 'resp.cat')) %>%
drop_na(RD.metric) %>%
distinct(caseID ,studyID,duration, open, organism, system,dist.cat,resp.cat,OEV,AUC.sum.delatbm.tot, RD.metric, RD.value) %>%
# filter(!str_detect(RD.metric, 'abs'))%>%
spread(key = RD.metric, value = RD.value)
setdiff(AllStab$caseID,metadata$caseID)
hist(metadata$OEV)
unique(metadata$caseID)
metadata <- filter(metadata, resp.cat !=  "contribution to production")
# unweighted MA requires column 1
metadata$unweighted<-1
names(metadata)
#remove all
m1<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~RD_diss+RD_div+mean_spp_pi+var_spp_pi+resp.cat+dist.cat+system+open+duration+organism,
random = ~ 1 | caseID,
method="REML",data=RelMetadata)
summary(m1) #190.6149
#remove all
m04<-rma.mv(AUC.sum.delatbm.tot,unweighted,
mods = ~mean_spp_deltabm,
random = ~ 1 | caseID,
method="REML",data=metadata)
summary(m04) #185.7469
